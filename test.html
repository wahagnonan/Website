<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vedoo</title>

<!-- Tailwind CSS via CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<!-- Monaco Editor -->
<link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/editor/editor.main.min.css">

<!-- xterm.js (Note: le terminal actuel est une simulation HTML/JS, xterm.js n'est pas activement utilisé par le JS ci-dessous) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.1.0/css/xterm.css">

<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        colors: {
          primary: {
            DEFAULT: '#FF5757',
            foreground: '#ffffff',
            hover: '#FF3A3A',
          },
          secondary: {
            DEFAULT: '#6366F1',
            foreground: '#ffffff',
          },
          border: {
            DEFAULT: '#E5E7EB',
            dark: '#374151',
          },
          background: {
            light: '#ffffff',
            dark: '#111827',
            panel: '#F9FAFB',
            'panel-dark': '#1F2937',
          },
        },
        fontFamily: {
          sans: ['Inter', 'sans-serif'],
        },
      }
    }
  }
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  
  body {
    font-family: 'Inter', sans-serif;
  }
  
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: #CBD5E1;
    border-radius: 4px;
  }
  .dark ::-webkit-scrollbar-thumb {
    background: #4B5563;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #94A3B8;
  }
  .dark ::-webkit-scrollbar-thumb:hover {
    background: #6B7280;
  }
  
  /* Monaco editor container */
  #editor {
    height: 100%;
    width: 100%;
    min-height: 300px;
  }
  
  /* Terminal container */
  #terminal {
    /* height: 200px; Déjà défini par Tailwind h-48 */
  }
  
  /* File tree styles */
  .file-tree-item {
    cursor: pointer;
    user-select: none;
    border-radius: 0.25rem;
    transition: background-color 0.15s ease;
  }
  
  .file-tree-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }
  
  .dark .file-tree-item:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }
  
  .file-children {
    margin-left: 1.25rem;
    display: none;
    /* Pour une animation de déploiement plus fluide, on pourrait utiliser max-height
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out; */
  }
  
  .file-children.open {
    display: block;
    /* max-height: 1000px; ajuster si nécessaire */
  }
  
  .bi-chevron-right { /* Style de base pour la flèche */
    transition: transform 0.2s ease;
  }

  .chevron-rotate { /* Appliqué quand le dossier est ouvert */
    transform: rotate(90deg);
  }
  
  .preview-container {
    height: 100%;
    width: 100%;
    display: none;
    background: white;
    border: none;
  }
  
  .dark .preview-container {
    background: #1E1E1E; /* Correspond à vs-dark de Monaco pour la cohérence */
  }
  
  .editor-container {
    height: calc(100% - 40px); /* 40px est la hauteur approx de la barre d'onglets/chemin de fichier */
    overflow: hidden;
  }
  
  .terminal-container {
    border-top: 1px solid #E5E7EB; /* Tailwind: border-border */
  }
  
  .dark .terminal-container {
    border-top: 1px solid #374151; /* Tailwind: dark:border-border-dark */
  }
  
  .chat-container {
    border-left: 1px solid #E5E7EB;
  }
  
  .dark .chat-container {
    border-left: 1px solid #374151;
  }
  
  .bi {
    display: inline-block;
    vertical-align: -0.125em;
  }
  
  .tab-active {
    border-bottom: 2px solid #FF5757; /* primary.DEFAULT */
    color: #FF5757;
  }
  
  .dark .tab-active {
    border-bottom: 2px solid #FF5757;
    color: #FF5757;
  }
  
  .btn-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.375rem; /* rounded-md */
    padding: 0.5rem; /* p-2 */
    transition: background-color 0.15s ease;
  }
  
  .btn-icon:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }
  
  .dark .btn-icon:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }
  
  .logo-gradient {
    background: linear-gradient(90deg, #FF5757 0%, #FF8A8A 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-fill-color: transparent;
  }
  
  /* Resizable panels */
  .resizable {
    position: relative;
  }
  
  .resizer {
    position: absolute;
    z-index: 10;
  }
  
  .resizer-horizontal {
    cursor: ew-resize;
    width: 5px;
    right: 0;
    top: 0;
    bottom: 0;
    background-color: transparent; /* Rendu visible au survol */
  }
  
  .resizer-horizontal:hover,
  .resizer-horizontal.active {
    background-color: rgba(0, 0, 0, 0.1);
  }
  
  .dark .resizer-horizontal:hover,
  .dark .resizer-horizontal.active {
    background-color: rgba(255, 255, 255, 0.1);
  }
  
  .resizer-vertical { /* Non utilisé dans cette disposition, mais défini pour complétude */
    cursor: ns-resize;
    height: 5px;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: transparent;
  }
  
  .resizer-vertical:hover,
  .resizer-vertical.active {
    background-color: rgba(0, 0, 0, 0.1);
  }
  
  .dark .resizer-vertical:hover,
  .dark .resizer-vertical.active {
    background-color: rgba(255, 255, 255, 0.1);
  }
  
  .chat-messages {
    height: calc(100% - 120px); /* Ajuster selon la hauteur du header et input du chat */
    overflow-y: auto;
  }
  
  .file-active {
    background-color: rgba(0, 0, 0, 0.05); /* Un peu plus foncé pour indiquer la sélection */
  }
  
  .dark .file-active {
    background-color: rgba(255, 255, 255, 0.05);
  }
    
  .terminal-caret {
    animation: blink 1s step-end infinite;
    background-color: currentColor; /* S'assure que le curseur a la couleur du texte */
    display: inline-block;
    width: 0.5em; /* Ajuster la largeur du curseur */
    margin-left: 2px;
  }
  
  @keyframes blink {
    from, to {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }
</style>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white transition-colors duration-200">
<div class="flex h-screen flex-col">
  <!-- Header -->
  <header class="sticky top-0 z-50 flex h-14 items-center justify-between border-b border-border dark:border-border-dark bg-white px-4 dark:bg-gray-900">
    <div class="flex items-center gap-4">
      <div class="flex items-center">
        <a href="#" class="flex items-center gap-2 font-semibold">
          <span class="text-2xl font-bold logo-gradient">Vedoo</span>
        </a>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button id="theme-toggle" class="btn-icon" aria-label="Toggle theme">
        <i class="bi bi-sun-fill text-lg hidden dark:block"></i>
        <i class="bi bi-moon-fill text-lg block dark:hidden"></i>
      </button>
      <button class="btn-icon" aria-label="GitHub">
        <i class="bi bi-github text-lg"></i>
      </button>
      <button class="btn-icon" aria-label="Settings">
        <i class="bi bi-gear-fill text-lg"></i>
      </button>
      <div class="flex h-8 w-8 items-center justify-center rounded-full bg-primary text-white">
        <span class="text-sm font-medium">U</span>
      </div>
    </div>
  </header>
  
  <!-- Main Content -->
  <div class="flex flex-1 overflow-hidden">
    <!-- Sidebar / File Explorer with resizer -->
    <div id="file-explorer" class="resizable w-64 bg-background-panel dark:bg-background-panel-dark overflow-hidden flex flex-col">
      <div class="flex items-center justify-between p-2 border-b border-border dark:border-border-dark">
        <span class="text-sm font-medium">EXPLORER</span>
        <div class="flex items-center">
          <button class="btn-icon p-1" id="refresh-explorer" aria-label="Refresh">
            <i class="bi bi-arrow-clockwise text-sm"></i>
          </button>
        </div>
      </div>
      <div class="overflow-y-auto flex-1 p-2">
        <!-- File Tree for Django Project -->
        <div class="file-tree">
          <!-- manage.py -->
          <div class="file-tree-item flex items-center p-1.5 rounded" data-file="manage.py">
            <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
            <span class="text-sm">manage.py</span>
          </div>
          
          <!-- requirements.txt -->
          <div class="file-tree-item flex items-center p-1.5 rounded" data-file="requirements.txt">
            <i class="bi bi-file-earmark-text-fill text-gray-500 mr-1.5"></i>
            <span class="text-sm">requirements.txt</span>
          </div>
          
          <!-- .gitignore -->
          <div class="file-tree-item flex items-center p-1.5 rounded" data-file=".gitignore">
            <i class="bi bi-file-earmark-text-fill text-gray-500 mr-1.5"></i>
            <span class="text-sm">.gitignore</span>
          </div>
          
          <!-- README.md -->
          <div class="file-tree-item flex items-center p-1.5 rounded" data-file="README.md">
            <i class="bi bi-file-earmark-text-fill text-blue-500 mr-1.5"></i>
            <span class="text-sm">README.md</span>
          </div>
          
          <!-- VPRO (project folder) -->
          <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="VPRO">
            <i class="bi bi-chevron-right mr-1.5"></i>
            <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
            <span class="text-sm">VPRO</span>
          </div>
          <div class="file-children" id="VPRO-children">
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="VPRO/settings.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">settings.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="VPRO/urls.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">urls.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="VPRO/wsgi.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">wsgi.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="VPRO/asgi.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">asgi.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="VPRO/__init__.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">__init__.py</span>
            </div>
          </div>
          
          <!-- Vapp (app folder) -->
          <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp">
            <i class="bi bi-chevron-right mr-1.5"></i>
            <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
            <span class="text-sm">Vapp</span>
          </div>
          <div class="file-children" id="Vapp-children">
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/models.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">models.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/views.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">views.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/urls.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">urls.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/admin.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">admin.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/apps.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">apps.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/tests.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">tests.py</span>
            </div>
            <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/__init__.py">
              <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
              <span class="text-sm">__init__.py</span>
            </div>
            
            <!-- Vapp/migrations folder -->
            <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp/migrations">
              <i class="bi bi-chevron-right mr-1.5"></i>
              <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
              <span class="text-sm">migrations</span>
            </div>
            <div class="file-children" id="Vapp/migrations-children">
              <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/migrations/__init__.py">
                <i class="bi bi-file-earmark-code-fill text-green-500 mr-1.5"></i>
                <span class="text-sm">__init__.py</span>
              </div>
            </div>
            
            <!-- Vapp/templates folder -->
            <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp/templates">
              <i class="bi bi-chevron-right mr-1.5"></i>
              <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
              <span class="text-sm">templates</span>
            </div>
            <div class="file-children" id="Vapp/templates-children">
              <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp/templates/Vapp">
                <i class="bi bi-chevron-right mr-1.5"></i>
                <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
                <span class="text-sm">Vapp</span>
              </div>
              <div class="file-children" id="Vapp/templates/Vapp-children">
                <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/templates/Vapp/index.html">
                  <i class="bi bi-file-earmark-code-fill text-orange-500 mr-1.5"></i>
                  <span class="text-sm">index.html</span>
                </div>
                <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/templates/Vapp/base.html">
                  <i class="bi bi-file-earmark-code-fill text-orange-500 mr-1.5"></i>
                  <span class="text-sm">base.html</span>
                </div>
              </div>
            </div>
            
            <!-- Vapp/static folder -->
            <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp/static">
              <i class="bi bi-chevron-right mr-1.5"></i>
              <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
              <span class="text-sm">static</span>
            </div>
            <div class="file-children" id="Vapp/static-children">
              <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp/static/css">
                <i class="bi bi-chevron-right mr-1.5"></i>
                <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
                <span class="text-sm">css</span>
              </div>
              <div class="file-children" id="Vapp/static/css-children">
                <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/static/css/style.css">
                  <i class="bi bi-file-earmark-code-fill text-purple-500 mr-1.5"></i>
                  <span class="text-sm">style.css</span>
                </div>
              </div>
              <div class="file-tree-item flex items-center p-1.5 rounded" data-folder="Vapp/static/js">
                <i class="bi bi-chevron-right mr-1.5"></i>
                <i class="bi bi-folder-fill text-blue-500 mr-1.5"></i>
                <span class="text-sm">js</span>
              </div>
              <div class="file-children" id="Vapp/static/js-children">
                <div class="file-tree-item flex items-center p-1.5 rounded" data-file="Vapp/static/js/main.js">
                  <i class="bi bi-file-earmark-code-fill text-yellow-500 mr-1.5"></i>
                  <span class="text-sm">main.js</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="resizer resizer-horizontal" id="file-explorer-resizer"></div>
    </div>
    
    <!-- Main Editor Area -->
    <div class="flex-1 flex overflow-hidden">
      <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Editor Tabs -->
        <div class="flex items-center border-b border-border dark:border-border-dark bg-background-panel dark:bg-background-panel-dark">
          <div class="flex items-center px-4 py-2">
            <div class="flex items-center">
              <button id="preview-btn" class="px-3 py-1.5 text-sm flex items-center gap-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-t-md">
                <i class="bi bi-eye text-sm"></i>
                <span>Preview</span>
              </button>
              <button id="code-btn" class="px-3 py-1.5 text-sm flex items-center gap-1 tab-active hover:bg-gray-100 dark:hover:bg-gray-800 rounded-t-md">
                <i class="bi bi-code-slash text-sm"></i>
                <span>Code</span>
              </button>
            </div>
          </div>
          <div class="ml-auto flex items-center px-4">
            <button id="toggle-terminal-btn" class="btn-icon" aria-label="Toggle Terminal">
              <i class="bi bi-terminal text-lg"></i>
            </button>
          </div>
        </div>
        
        <!-- File Path -->
        <div id="file-path" class="flex items-center border-b border-border dark:border-border-dark bg-white px-4 py-1.5 text-sm text-gray-500 dark:bg-gray-900 dark:text-gray-400">
          <span>Sélectionnez un fichier pour voir son contenu</span>
        </div>
        
        <!-- Editor Container -->
        <div class="editor-container flex-1 overflow-hidden">
          <div id="editor"></div>
          <iframe id="preview-frame" class="preview-container" sandbox="allow-same-origin allow-scripts"></iframe>
        </div>
        
        <!-- Terminal -->
        <div id="terminal" class="terminal-container h-48 bg-black text-white font-mono text-sm hidden"> <!-- Added font-mono and text-sm for terminal look -->
          <div class="flex items-center justify-between border-b border-gray-700 px-4 py-1.5">
            <span class="text-sm font-medium">TERMINAL</span>
            <div class="flex items-center">
              <button class="text-gray-400 hover:text-white px-2">
                <i class="bi bi-plus"></i>
              </button>
              <button class="text-gray-400 hover:text-white px-2" id="clear-terminal-btn">
                <i class="bi bi-trash"></i>
              </button>
              <button id="close-terminal-btn" class="text-gray-400 hover:text-white px-2">
                <i class="bi bi-x-lg"></i>
              </button>
            </div>
          </div>
          <div id="terminal-content-area" class="h-full p-2 overflow-auto" tabindex="0"></div> <!-- Changed ID and added tabindex -->
        </div>
      </div>
      
      <!-- Chat Panel (vertical on right) -->
      <div class="chat-container w-80 bg-white dark:bg-gray-900 flex flex-col">
        <div class="border-b border-border dark:border-border-dark p-3">
          <h2 class="font-medium">Chat</h2>
        </div>
        
        <!-- Chat Messages -->
        <div class="chat-messages p-3">
          <div class="mb-4">
            <div class="flex items-start mb-1">
              <div class="flex h-8 w-8 items-center justify-center rounded-full bg-primary text-white mr-2 flex-shrink-0">
                <span class="text-sm font-medium">V</span>
              </div>
              <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-3 max-w-[85%]">
                <p class="text-sm">Bonjour ! Comment puis-je vous aider aujourd'hui ?</p>
              </div>
            </div>
            <span class="text-xs text-gray-500 dark:text-gray-400 ml-10">10:30 AM</span>
          </div>
          
          <div class="mb-4">
            <div class="flex items-start justify-end mb-1">
              <div class="bg-primary text-white rounded-lg p-3 max-w-[85%]">
                <p class="text-sm">Je travaille sur un projet Django et j'ai besoin d'aide avec les modèles.</p>
              </div>
              <div class="flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 ml-2 flex-shrink-0">
                <span class="text-sm font-medium">U</span>
              </div>
            </div>
            <span class="text-xs text-gray-500 dark:text-gray-400 mr-10 flex justify-end">10:32 AM</span>
          </div>
          
          <div class="mb-4">
            <div class="flex items-start mb-1">
              <div class="flex h-8 w-8 items-center justify-center rounded-full bg-primary text-white mr-2 flex-shrink-0">
                <span class="text-sm font-medium">V</span>
              </div>
              <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-3 max-w-[85%]">
                <p class="text-sm">Bien sûr ! Les modèles Django définissent la structure de vos données. Vous pouvez créer un modèle en définissant une classe qui hérite de django.db.models.Model. Que souhaitez-vous modéliser ?</p>
              </div>
            </div>
            <span class="text-xs text-gray-500 dark:text-gray-400 ml-10">10:33 AM</span>
          </div>
        </div>
        
        <!-- Chat Input -->
        <div class="mt-auto p-3 border-t border-border dark:border-border-dark">
          <div class="relative">
            <textarea
              id="chat-input"
              placeholder="Posez votre question..."
              class="w-full rounded-lg border border-gray-300 bg-white px-4 py-2 pr-10 text-sm focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-primary"
              rows="3"
            ></textarea>
            <div class="absolute bottom-2 right-2 flex items-center space-x-1">
              <button class="rounded p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <i class="bi bi-paperclip text-lg"></i>
              </button>
              <button class="rounded p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <i class="bi bi-stars text-lg"></i>
              </button>
            </div>
          </div>
          <div class="flex justify-between items-center mt-2">
            <span class="text-xs text-gray-500 dark:text-gray-400">Vedoo peut faire des erreurs.</span>
            <button id="send-message-btn" class="rounded-lg bg-primary px-3 py-1.5 text-sm font-medium text-white hover:bg-primary-hover">
              <i class="bi bi-send-fill"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Monaco Editor -->
<script>var require = { paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs' } };</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/loader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/editor/editor.main.nls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/editor/editor.main.js"></script>

<!-- xterm.js (script - non utilisé activement par le JS du terminal actuel) -->
<script src="https://cdn.jsdelivr.net/npm/xterm@5.1.0/lib/xterm.js"></script>

<script>
  // File content data
  const fileContents = {
    "manage.py": `#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
  """Run administrative tasks."""
  os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'VPRO.settings')
  try:
      from django.core.management import execute_from_command_line
  except ImportError as exc:
      raise ImportError(
          "Couldn't import Django. Are you sure it's installed and "
          "available on your PYTHONPATH environment variable? Did you "
          "forget to activate a virtual environment?"
      ) from exc
  execute_from_command_line(sys.argv)


if __name__ == '__main__':
  main()`,
    
    "requirements.txt": `Django==4.2.7
Pillow==10.0.0
psycopg2-binary==2.9.6
python-dotenv==1.0.0
djangorestframework==3.14.0
django-cors-headers==4.2.0
gunicorn==21.2.0`,
    
    ".gitignore": `# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
*.egg-info/
.installed.cfg
*.egg

# Django
*.log
local_settings.py
db.sqlite3
db.sqlite3-journal
media/

# Virtual Environment
venv/
ENV/

# IDE
.idea/
.vscode/
*.swp
*.swo`,
    
    "README.md": `# VPRO Django Project

A Django project with a Vapp application.

## Setup

1. Clone the repository
2. Create a virtual environment: \`python -m venv venv\`
3. Activate the virtual environment:
 - Windows: \`venv\\Scripts\\activate\`
 - Unix/MacOS: \`source venv/bin/activate\`
4. Install dependencies: \`pip install -r requirements.txt\`
5. Run migrations: \`python manage.py migrate\`
6. Create a superuser: \`python manage.py createsuperuser\`
7. Run the development server: \`python manage.py runserver\`

## Features

- Feature 1
- Feature 2
- Feature 3`,
    
    "VPRO/settings.py": `"""
Django settings for VPRO project.
"""

from pathlib import Path
import os

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-abc123!@#$%^&*()'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []

# Application definition
INSTALLED_APPS = [
  'django.contrib.admin',
  'django.contrib.auth',
  'django.contrib.contenttypes',
  'django.contrib.sessions',
  'django.contrib.messages',
  'django.contrib.staticfiles',
  'Vapp',
  'rest_framework',
  'corsheaders',
]

MIDDLEWARE = [
  'django.middleware.security.SecurityMiddleware',
  'django.contrib.sessions.middleware.SessionMiddleware',
  'corsheaders.middleware.CorsMiddleware',
  'django.middleware.common.CommonMiddleware',
  'django.middleware.csrf.CsrfViewMiddleware',
  'django.contrib.auth.middleware.AuthenticationMiddleware',
  'django.contrib.messages.middleware.MessageMiddleware',
  'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'VPRO.urls'

TEMPLATES = [
  {
      'BACKEND': 'django.template.backends.django.DjangoTemplates',
      'DIRS': [],
      'APP_DIRS': True,
      'OPTIONS': {
          'context_processors': [
              'django.template.context_processors.debug',
              'django.template.context_processors.request',
              'django.contrib.auth.context_processors.auth',
              'django.contrib.messages.context_processors.messages',
          ],
      },
  },
]

WSGI_APPLICATION = 'VPRO.wsgi.application'

# Database
DATABASES = {
  'default': {
      'ENGINE': 'django.db.backends.sqlite3',
      'NAME': BASE_DIR / 'db.sqlite3',
  }
}

# Password validation
AUTH_PASSWORD_VALIDATORS = [
  {
      'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
  },
  {
      'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
  },
  {
      'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
  },
  {
      'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
  },
]

# Internationalization
LANGUAGE_CODE = 'fr-fr'
TIME_ZONE = 'Europe/Paris'
USE_I18N = True
USE_TZ = True

# Static files (CSS, JavaScript, Images)
STATIC_URL = 'static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# Media files
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# Default primary key field type
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# CORS settings
CORS_ALLOW_ALL_ORIGINS = True`,
    
    "VPRO/urls.py": `"""VPRO URL Configuration"""
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
  path('admin/', admin.site.urls),
  path('', include('Vapp.urls')),
]

if settings.DEBUG:
  urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)`,
    
    "VPRO/wsgi.py": `"""
WSGI config for VPRO project.
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'VPRO.settings')

application = get_wsgi_application()`,
    
    "VPRO/asgi.py": `"""
ASGI config for VPRO project.
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'VPRO.settings')

application = get_asgi_application()`,
    
    "VPRO/__init__.py": `# This file is intentionally left empty to mark this directory as a Python package.`,
    
    "Vapp/models.py": `from django.db import models
from django.contrib.auth.models import User

class Category(models.Model):
  name = models.CharField(max_length=100)
  description = models.TextField(blank=True, null=True)
  created_at = models.DateTimeField(auto_now_add=True)
  
  def __str__(self):
      return self.name
  
  class Meta:
      verbose_name_plural = "Categories"

class Product(models.Model):
  name = models.CharField(max_length=200)
  description = models.TextField()
  price = models.DecimalField(max_digits=10, decimal_places=2)
  category = models.ForeignKey(Category, on_delete=models.CASCADE, related_name='products')
  image = models.ImageField(upload_to='products/', blank=True, null=True)
  stock = models.PositiveIntegerField(default=0)
  is_available = models.BooleanField(default=True)
  created_at = models.DateTimeField(auto_now_add=True)
  updated_at = models.DateTimeField(auto_now=True)
  
  def __str__(self):
      return self.name

class Order(models.Model):
  STATUS_CHOICES = (
      ('pending', 'Pending'),
      ('processing', 'Processing'),
      ('shipped', 'Shipped'),
      ('delivered', 'Delivered'),
      ('cancelled', 'Cancelled'),
  )
  
  user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='orders')
  status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')
  total_price = models.DecimalField(max_digits=10, decimal_places=2)
  shipping_address = models.TextField()
  created_at = models.DateTimeField(auto_now_add=True)
  updated_at = models.DateTimeField(auto_now=True)
  
  def __str__(self):
      return f"Order {self.id} - {self.user.username}"

class OrderItem(models.Model):
  order = models.ForeignKey(Order, on_delete=models.CASCADE, related_name='items')
  product = models.ForeignKey(Product, on_delete=models.CASCADE)
  quantity = models.PositiveIntegerField(default=1)
  price = models.DecimalField(max_digits=10, decimal_places=2)
  
  def __str__(self):
      return f"{self.quantity} x {self.product.name}"`,
    
    "Vapp/views.py": `from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required
from django.http import JsonResponse
from .models import Category, Product, Order, OrderItem
# from .forms import ProductForm, OrderForm # Assuming forms.py exists

# Dummy forms for example purposes if forms.py is not provided
from django import forms
class ProductForm(forms.ModelForm):
    class Meta:
        model = Product
        fields = '__all__'

class OrderForm(forms.ModelForm):
    class Meta:
        model = Order
        exclude = ['user', 'total_price']


def index(request):
  """Home page view"""
  categories = Category.objects.all()
  featured_products = Product.objects.filter(is_available=True)[:6]
  return render(request, 'Vapp/index.html', {
      'categories': categories,
      'featured_products': featured_products
  })

def product_list(request):
  """List all products"""
  category_id = request.GET.get('category')
  if category_id:
      products = Product.objects.filter(category_id=category_id, is_available=True)
      category = get_object_or_404(Category, id=category_id)
      title = f"Products in {category.name}"
  else:
      products = Product.objects.filter(is_available=True)
      title = "All Products"
  
  return render(request, 'Vapp/product_list.html', {
      'products': products,
      'title': title
  })

def product_detail(request, product_id):
  """Show product details"""
  product = get_object_or_404(Product, id=product_id, is_available=True)
  related_products = Product.objects.filter(
      category=product.category, 
      is_available=True
  ).exclude(id=product_id)[:4]
  
  return render(request, 'Vapp/product_detail.html', {
      'product': product,
      'related_products': related_products
  })

@login_required
def add_to_cart(request, product_id):
  """Add product to cart"""
  if request.method == 'POST':
      product = get_object_or_404(Product, id=product_id)
      quantity = int(request.POST.get('quantity', 1))
      
      # Here you would implement cart logic
      # For simplicity, we'll just return success
      return JsonResponse({'status': 'success', 'message': 'Product added (simulated)'})
  
  return JsonResponse({'status': 'error', 'message': 'Invalid request'})

@login_required
def checkout(request):
  """Checkout process"""
  if request.method == 'POST':
      form = OrderForm(request.POST)
      if form.is_valid():
          order = form.save(commit=False)
          order.user = request.user
          # Simulate total_price calculation
          order.total_price = 0 # In a real app, calculate from cart
          order.save()
          
          # Process cart items to order items
          # This is simplified - you'd need to implement cart functionality
          
          # return redirect('order_confirmation', order_id=order.id) # Assuming 'order_confirmation' URL exists
          return JsonResponse({'status': 'success', 'order_id': order.id, 'message': 'Order created (simulated)'})

  else:
      form = OrderForm()
  
  return render(request, 'Vapp/checkout.html', {'form': form}) # Assuming checkout.html template exists

@login_required
def order_history(request):
  """View order history"""
  orders = Order.objects.filter(user=request.user).order_by('-created_at')
  # return render(request, 'Vapp/order_history.html', {'orders': orders}) # Assuming order_history.html exists
  return JsonResponse({'status': 'success', 'orders_count': orders.count()})
`,
    
    "Vapp/urls.py": `from django.urls import path
from . import views

urlpatterns = [
  path('', views.index, name='index'),
  path('products/', views.product_list, name='product_list'),
  path('products/<int:product_id>/', views.product_detail, name='product_detail'),
  path('products/<int:product_id>/add-to-cart/', views.add_to_cart, name='add_to_cart'),
  path('checkout/', views.checkout, name='checkout'),
  path('orders/', views.order_history, name='order_history'),
  # path('order/<int:order_id>/confirmation/', views.order_confirmation, name='order_confirmation'), # Example
]`,
    
    "Vapp/admin.py": `from django.contrib import admin
from .models import Category, Product, Order, OrderItem

@admin.register(Category)
class CategoryAdmin(admin.ModelAdmin):
  list_display = ('name', 'created_at')
  search_fields = ('name',)

@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
  list_display = ('name', 'price', 'category', 'stock', 'is_available')
  list_filter = ('category', 'is_available')
  search_fields = ('name', 'description')
  list_editable = ('price', 'stock', 'is_available')

class OrderItemInline(admin.TabularInline):
  model = OrderItem
  extra = 0

@admin.register(Order)
class OrderAdmin(admin.ModelAdmin):
  list_display = ('id', 'user', 'status', 'total_price', 'created_at')
  list_filter = ('status', 'created_at')
  search_fields = ('user__username',)
  inlines = [OrderItemInline]`,
    
    "Vapp/apps.py": `from django.apps import AppConfig

class VappConfig(AppConfig):
  default_auto_field = 'django.db.models.BigAutoField'
  name = 'Vapp'`,
    
    "Vapp/tests.py": `from django.test import TestCase
from django.urls import reverse
from django.contrib.auth.models import User
from .models import Category, Product, Order

class CategoryModelTest(TestCase):
  def setUp(self):
      Category.objects.create(name="Test Category")
  
  def test_category_name(self):
      category = Category.objects.get(name="Test Category")
      self.assertEqual(str(category), "Test Category")

class ProductModelTest(TestCase):
  def setUp(self):
      category = Category.objects.create(name="Test Category")
      Product.objects.create(
          name="Test Product",
          description="Test Description",
          price=99.99,
          category=category,
          stock=10
      )
  
  def test_product_name(self):
      product = Product.objects.get(name="Test Product")
      self.assertEqual(str(product), "Test Product")
      self.assertEqual(product.price, 99.99)

class IndexViewTest(TestCase):
  def setUp(self):
      # Create a user for login-required views if needed
      # self.user = User.objects.create_user(username='testuser', password='password')
      # self.client.login(username='testuser', password='password')

      category = Category.objects.create(name="Test Category")
      for i in range(10):
          Product.objects.create(
              name=f"Product {i}",
              description=f"Description {i}",
              price=10.00 + i,
              category=category,
              stock=i+5
          )
  
  def test_index_view(self):
      response = self.client.get(reverse('index'))
      self.assertEqual(response.status_code, 200)
      self.assertTemplateUsed(response, 'Vapp/index.html')
      self.assertTrue('featured_products' in response.context)
      self.assertTrue('categories' in response.context)`,
    
    "Vapp/__init__.py": `# This file is intentionally left empty to mark this directory as a Python package.`,
    "Vapp/migrations/__init__.py": `# This file is intentionally left empty to mark this directory as a Python package.`,
    
    "Vapp/templates/Vapp/index.html": `{% extends 'Vapp/base.html' %}
{% load static %} {# Make sure static is loaded if base.html uses it extensively before this block #}

{% block title %}Welcome to VPRO{% endblock %}

{% block content %}
<div class="hero bg-primary text-white py-5">
  <div class="container">
      <h1 class="display-4">Welcome to VPRO</h1>
      <p class="lead">Discover our amazing products</p>
      <a href="{% url 'product_list' %}" class="btn btn-light btn-lg">Shop Now</a>
  </div>
</div>

<div class="container my-5">
  <h2 class="text-center mb-4">Featured Products</h2>
  
  <div class="row">
      {% for product in featured_products %}
      <div class="col-md-4 mb-4">
          <div class="card h-100">
              {% if product.image and product.image.url %}
              <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
              {% else %}
              <div class="bg-light text-center py-5 d-flex align-items-center justify-content-center" style="height: 200px;"><span>No Image</span></div>
              {% endif %}
              <div class="card-body d-flex flex-column">
                  <h5 class="card-title">{{ product.name }}</h5>
                  <p class="card-text">{{ product.description|truncatewords:20 }}</p>
                  <p class="card-text font-weight-bold">\${{ product.price }}</p>
                  <a href="{% url 'product_detail' product.id %}" class="btn btn-primary mt-auto">View Details</a>
              </div>
          </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
          <p>No products available at the moment.</p>
      </div>
      {% endfor %}
  </div>
  
  <div class="text-center mt-4">
      <a href="{% url 'product_list' %}" class="btn btn-outline-primary">View All Products</a>
  </div>
</div>

<div class="container my-5">
  <h2 class="text-center mb-4">Shop by Category</h2>
  
  <div class="row">
      {% for category in categories %}
      <div class="col-md-4 mb-4">
          <div class="card text-center">
              <div class="card-body">
                  <h5 class="card-title">{{ category.name }}</h5>
                  <p class="card-text">{{ category.description|default:"" }}</p>
                  <a href="{% url 'product_list' %}?category={{ category.id }}" class="btn btn-primary">Browse</a>
              </div>
          </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
          <p>No categories available.</p>
      </div>
      {% endfor %}
  </div>
</div>
{% endblock %}`,
    
    "Vapp/templates/Vapp/base.html": `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}VPRO{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <header>
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
          <div class="container">
              <a class="navbar-brand" href="{% url 'index' %}">VPRO</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                  <ul class="navbar-nav me-auto">
                      <li class="nav-item">
                          <a class="nav-link active" aria-current="page" href="{% url 'index' %}">Home</a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="{% url 'product_list' %}">Products</a>
                      </li>
                  </ul>
                  <div class="d-flex align-items-center">
                      <a href="#" class="btn btn-outline-light me-2 position-relative">
                          <i class="bi bi-cart"></i> Cart
                          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-badge-display">
                            0 <span class="visually-hidden">items in cart</span>
                          </span>
                      </a>
                      {% if user.is_authenticated %}
                      <div class="dropdown">
                          <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="bi bi-person"></i> {{ user.username }}
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                              <li><a class="dropdown-item" href="{% url 'order_history' %}">My Orders</a></li>
                              <li><a class="dropdown-item" href="#">Profile</a></li>
                              <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="#">Logout</a></li> {# Replace with actual logout URL #}
                          </ul>
                      </div>
                      {% else %}
                      <a href="#" class="btn btn-outline-light"> {# Replace with actual login URL #}
                          <i class="bi bi-box-arrow-in-right"></i> Login
                      </a>
                      {% endif %}
                  </div>
              </div>
          </div>
      </nav>
  </header>

  <main class="py-4">
      {% block content %}{% endblock %}
  </main>

  <footer class="bg-dark text-white py-4 mt-auto">
      <div class="container">
          <div class="row">
              <div class="col-md-4 mb-3 mb-md-0">
                  <h5>VPRO</h5>
                  <p>Your one-stop shop for quality products.</p>
              </div>
              <div class="col-md-4 mb-3 mb-md-0">
                  <h5>Quick Links</h5>
                  <ul class="list-unstyled">
                      <li><a href="{% url 'index' %}" class="text-white text-decoration-none">Home</a></li>
                      <li><a href="{% url 'product_list' %}" class="text-white text-decoration-none">Products</a></li>
                      <li><a href="#" class="text-white text-decoration-none">About Us</a></li>
                      <li><a href="#" class="text-white text-decoration-none">Contact</a></li>
                  </ul>
              </div>
              <div class="col-md-4">
                  <h5>Contact Us</h5>
                  <address class="mb-0">
                      <p class="mb-1"><i class="bi bi-geo-alt-fill me-2"></i>123 Main Street, City, Country</p>
                      <p class="mb-1"><i class="bi bi-envelope-fill me-2"></i>info@vpro.com</p>
                      <p class="mb-0"><i class="bi bi-telephone-fill me-2"></i>+1 234 567 890</p>
                  </address>
              </div>
          </div>
          <hr class="my-3">
          <div class="text-center">
              <p class="mb-0">© {% now "Y" %} VPRO. All rights reserved.</p>
          </div>
      </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/main.js' %}"></script>
  {% block extra_js %}{% endblock %}
</body>
</html>`,
    
    "Vapp/static/css/style.css": `/* Main Styles */
:root {
--primary-color: #FF5757; /* Match Tailwind primary */
--secondary-color: #6c757d;
--success-color: #198754; /* Bootstrap 5 success */
--danger-color: #dc3545; /* Bootstrap 5 danger */
--light-color: #f8f9fa;
--dark-color: #212529; /* Bootstrap 5 dark */
}

body {
font-family: 'Inter', sans-serif; /* Match main font */
line-height: 1.6;
color: #333;
display: flex;
flex-direction: column;
min-height: 100vh;
}

main {
  flex-grow: 1;
}

/* Hero Section */
.hero {
/* background: linear-gradient(135deg, var(--primary-color), #FF8A8A); */ /* Using primary color directly */
background-color: var(--primary-color);
padding: 4rem 0;
margin-bottom: 2rem;
}

.hero h1 {
font-weight: 700;
}

/* Product Cards */
.card {
transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
border: 1px solid rgba(0,0,0,.125); /* Default Bootstrap border */
/* box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); */ /* Subtle shadow */
}

.card:hover {
transform: translateY(-5px);
box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
}

.card-img-top {
height: 200px;
object-fit: cover;
}

.card-title {
  font-weight: 600;
}

/* Buttons */
.btn-primary {
background-color: var(--primary-color);
border-color: var(--primary-color);
}

.btn-primary:hover {
filter: brightness(90%); /* Darken primary color on hover */
background-color: var(--primary-color); 
border-color: var(--primary-color);
}

.btn-outline-primary {
  border-color: var(--primary-color);
  color: var(--primary-color);
}
.btn-outline-primary:hover {
  background-color: var(--primary-color);
  color: white;
}


/* Footer */
footer a:hover {
color: var(--light-color) !important;
text-decoration: underline !important;
}

/* Product Detail */
.product-detail-img {
max-height: 400px;
object-fit: contain;
border: 1px solid #dee2e6; /* Bootstrap light border */
border-radius: .25rem; /* Bootstrap rounded */
}

/* Cart Badge in Navbar */
.navbar .cart-badge-display {
  font-size: 0.7rem;
  padding: .25em .5em;
}

/* Notification styling (from main.js simulation) */
.notification.alert {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1050; /* Ensure it's above most elements */
  min-width: 250px;
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}


/* Responsive adjustments */
@media (max-width: 768px) {
  .hero {
    padding: 2.5rem 0;
    text-align: center;
  }
  .hero h1 {
    font-size: 2.5rem;
  }
  .card-img-top {
    height: 180px;
  }
  .navbar-nav {
    margin-top: 0.5rem;
  }
  .navbar .d-flex {
    margin-top: 0.5rem;
    width: 100%;
    justify-content: space-between;
  }
}
`,
    
    "Vapp/static/js/main.js": `// Main JavaScript file for VPRO

document.addEventListener('DOMContentLoaded', function() {
  // Initialize Bootstrap tooltips (if any are used)
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
  });
  
  // Simulate Add to cart functionality
  const addToCartForms = document.querySelectorAll('.add-to-cart-form'); // Assuming forms have this class
  
  addToCartForms.forEach(form => {
      form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const productId = this.dataset.productId; // e.g., <form data-product-id="123">
          const quantityInput = this.querySelector('input[name="quantity"]');
          const quantity = quantityInput ? quantityInput.value : 1;
          
          // Create form data for POST request if needed, or prepare for fetch GET/POST
          const formData = new FormData();
          formData.append('quantity', quantity);
          // Add CSRF token if it's a POST request to Django backend
          // formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));

          // Simulate fetch request to backend (replace with actual fetch)
          console.log(\`Simulating add to cart: Product ID \${productId}, Quantity \${quantity}\`);
          
          // Simulate API call
          // In a real app, you'd use: fetch(\`/products/\${productId}/add-to-cart/\`, { method: 'POST', body: formData, headers: {'X-CSRFToken': getCookie('csrftoken')} })
          new Promise((resolve, reject) => {
            setTimeout(() => {
              // Simulate success/failure
              if (Math.random() > 0.1) { // 90% success rate for simulation
                resolve({ status: 'success', message: 'Product added to cart!' });
              } else {
                reject({ status: 'error', message: 'Failed to add product to cart.' });
              }
            }, 500);
          })
          .then(data => {
              showNotification(data.message, 'success');
              updateCartCount(1); // Increment cart count by 1 (simulated)
          })
          .catch(error => {
              console.error('Error:', error);
              showNotification(error.message || 'An error occurred. Please try again.', 'danger');
          });
      });
  });
  
  // Helper function to get CSRF token (if Django forms are used for POST)
  function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  
  // Show notification
  function showNotification(message, type = 'info') { // type can be 'success', 'danger', 'warning', 'info'
      const notificationArea = document.body; // Or a dedicated notification container
      
      const notification = document.createElement('div');
      notification.className = \`alert alert-\${type} alert-dismissible fade show notification\`; // Bootstrap alert classes
      notification.setAttribute('role', 'alert');
      notification.innerHTML = \`
          \${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      \`;
      
      notificationArea.appendChild(notification);
      
      // Auto-dismiss after 5 seconds
      setTimeout(() => {
          // Use Bootstrap's dispose method if available, otherwise remove directly
          const bsAlert = bootstrap.Alert.getInstance(notification);
          if (bsAlert) {
            bsAlert.close();
          } else {
            notification.remove();
          }
      }, 5000);
  }
  
  // Update cart count display (simulated)
  let currentCartItems = 0; // Simulate cart items count
  const cartBadge = document.querySelector('.navbar .cart-badge-display');

  function updateCartCount(itemsToAdd = 0) {
      currentCartItems += itemsToAdd;
      if (cartBadge) {
          cartBadge.textContent = currentCartItems;
          cartBadge.classList.toggle('d-none', currentCartItems === 0); // Hide if 0
      }
      console.log('Cart count updated to:', currentCartItems);
  }
  // Initialize cart count display
  if (cartBadge) {
    updateCartCount(); // Call once to set initial state (e.g., 0 and hidden)
  }

});`
  };
  
  // Initialize Monaco Editor
  document.addEventListener('DOMContentLoaded', function() {
    let editor;
    let currentFile = null;
    let isDarkMode = document.documentElement.classList.contains('dark');
    
    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', function() {
      document.documentElement.classList.toggle('dark');
      isDarkMode = document.documentElement.classList.contains('dark');
      
      // Update Monaco Editor theme
      if (editor) {
        monaco.editor.setTheme(isDarkMode ? 'vs-dark' : 'vs');
      }
    });
    
    // Initialize Monaco Editor
    require(['vs/editor/editor.main'], function() {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: 'Sélectionnez un fichier pour voir son contenu.',
        language: 'plaintext',
        theme: isDarkMode ? 'vs-dark' : 'vs',
        automaticLayout: true,
        minimap: {
          enabled: false
        },
        scrollBeyondLastLine: false,
        fontSize: 14,
        lineNumbers: 'on',
        renderLineHighlight: 'all',
        scrollbar: {
          vertical: 'auto', // Changed from 'visible'
          horizontal: 'auto' // Changed from 'visible'
        },
        readOnly: false // Default, can be set to true if needed
      });
      
      // Resizing editor on window resize
      window.addEventListener('resize', function() {
        if (editor) {
          editor.layout();
        }
      });
      
      // Preview and Code toggling
      const previewBtn = document.getElementById('preview-btn');
      const codeBtn = document.getElementById('code-btn');
      const previewFrame = document.getElementById('preview-frame');
      const editorElement = document.getElementById('editor');
      const filePathDisplay = document.getElementById('file-path');
      
      previewBtn.addEventListener('click', function() {
        if (!currentFile) {
          filePathDisplay.textContent = "Aucun fichier sélectionné pour l'aperçu.";
          return;
        }
        
        const extension = currentFile.split('.').pop().toLowerCase();
        if (extension !== 'html') {
          alert('L\'aperçu n\'est disponible que pour les fichiers HTML.');
          // Optionally, switch back to code view if not already there
          if (!codeBtn.classList.contains('tab-active')) {
            codeBtn.click();
          }
          return;
        }
        
        previewBtn.classList.add('tab-active');
        codeBtn.classList.remove('tab-active');
        
        editorElement.style.display = 'none';
        previewFrame.style.display = 'block';
        
        const content = editor.getValue();
        const frameDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
        frameDoc.open();
        frameDoc.write(content);
        frameDoc.close();
      });
      
      codeBtn.addEventListener('click', function() {
        codeBtn.classList.add('tab-active');
        previewBtn.classList.remove('tab-active');
        
        editorElement.style.display = 'block';
        previewFrame.style.display = 'none';
        if (editor) editor.layout(); // Ensure editor resizes correctly
      });
      
      // File click handler
      const fileItems = document.querySelectorAll('.file-tree-item[data-file]');
      fileItems.forEach(item => {
        item.addEventListener('click', function() {
          const filePath = this.getAttribute('data-file');
          
          document.querySelectorAll('.file-tree-item.file-active').forEach(el => {
            el.classList.remove('file-active');
          });
          this.classList.add('file-active');
          
          filePathDisplay.textContent = filePath;
          
          const content = fileContents[filePath] || `// Contenu non disponible pour ${filePath}`;
          
          const extension = filePath.split('.').pop().toLowerCase();
          let language = 'plaintext';
          
          if (extension === 'py') language = 'python';
          else if (extension === 'js') language = 'javascript';
          else if (extension === 'html') language = 'html';
          else if (extension === 'css') language = 'css';
          else if (extension === 'md') language = 'markdown';
          else if (extension === 'txt' || filePath.endsWith('.gitignore')) language = 'plaintext'; // Check for .gitignore specifically
          
          monaco.editor.setModelLanguage(editor.getModel(), language);
          editor.setValue(content);
          
          currentFile = filePath;
          
          // If in preview mode and the new file is not HTML, switch to code view
          if (previewBtn.classList.contains('tab-active') && extension !== 'html') {
            codeBtn.click();
          }
          // If HTML file and in preview mode, refresh the preview
          else if (extension === 'html' && previewBtn.classList.contains('tab-active')) {
            // Re-trigger preview click to refresh content
             previewBtn.click();
          }
          // Default to code view if it's not active
          else if (!codeBtn.classList.contains('tab-active')) {
             codeBtn.click();
          }
        });
      });
      // Select a default file to show on load, e.g., README.md
      const readmeFile = document.querySelector('.file-tree-item[data-file="README.md"]');
      if (readmeFile) {
        readmeFile.click();
      } else {
        filePathDisplay.textContent = "Sélectionnez un fichier pour commencer.";
        if (editor) editor.setValue("Sélectionnez un fichier pour voir son contenu.");
      }

    });
    
    // Enhanced terminal functionality
    const terminalDisplayArea = document.getElementById('terminal-content-area'); // Updated ID
    const toggleTerminalBtn = document.getElementById('toggle-terminal-btn');
    const closeTerminalBtn = document.getElementById('close-terminal-btn');
    const clearTerminalBtn = document.getElementById('clear-terminal-btn');
    const terminalElement = document.getElementById('terminal'); // The main terminal container div
    
    let commandHistory = [];
    let historyIndex = -1;
    let currentCommand = '';
    const terminalPrompt = `<span class="text-green-400">user@vedoo</span>:<span class="text-blue-400">~</span>$ `; // More realistic prompt
    let terminalOutputBuffer = ''; // To build output before appending

    function escapeHtml(unsafe) {
        return unsafe
             .replace(/&/g, "&")
             .replace(/</g, "<")
             .replace(/>/g, ">")
             .replace(/"/g, """)
             .replace(/'/g, "'");
    }
    
    function initTerminal() {
      terminalOutputBuffer = `
<div class="mb-1"><span class="text-yellow-300">Vedoo Terminal Initialized</span> (simulated)</div>
<div class="mb-1">Type 'help' for a list of commands.</div>
<div>${terminalPrompt}<span id="current-command-display"></span><span class="terminal-caret"></span></div>`; // Added span for current command
      updateTerminalDisplay();
    }
    
    function updateTerminalDisplay() {
      terminalDisplayArea.innerHTML = terminalOutputBuffer;
      const currentCommandDisplay = document.getElementById('current-command-display');
      if (currentCommandDisplay) {
        currentCommandDisplay.textContent = currentCommand;
      }
      terminalDisplayArea.scrollTop = terminalDisplayArea.scrollHeight;
    }
    
    function appendToTerminalOutput(htmlContent) {
        // Remove the last line (prompt)
        const lines = terminalOutputBuffer.split('\n');
        lines.pop(); 
        terminalOutputBuffer = lines.join('\n') + '\n';
        
        terminalOutputBuffer += htmlContent;
        updateTerminalDisplay();
    }

    function processCommand(cmd) {
      const command = cmd.trim();
      appendToTerminalOutput(`<div>${terminalPrompt}${escapeHtml(command)}</div>`);
      
      if (command !== '') {
        commandHistory.push(command);
        historyIndex = commandHistory.length;
      }
      
      let output = '';
      switch (command) {
        case 'python manage.py runserver':
          output = `<div>Watching for file changes with StatReloader</div>
<div>Performing system checks...</div>
<div>System check identified no issues (0 silenced).</div>
<div>May 07, 2025 - 14:30:45</div>
<div>Django version 4.2.7, using settings 'VPRO.settings'</div>
<div>Starting development server at <a href="http://127.0.0.1:8000/" target="_blank" class="text-blue-400 hover:underline">http://127.0.0.1:8000/</a></div>
<div>Quit the server with CONTROL-C.</div>`;
          break;
        case 'python manage.py migrate':
          output = `<div>Operations to perform:</div>
<div>  Apply all migrations: admin, auth, contenttypes, sessions, Vapp</div>
<div>Running migrations:</div>
<div>  Applying Vapp.0001_initial... <span class="text-green-400">OK</span></div>
<div>  ... (Weitere Migrationen simuliert) ... <span class="text-green-400">OK</span></div>`;
          break;
        case 'ls':
          output = `<div class="whitespace-pre text-gray-300">manage.py  README.md  VPRO/  Vapp/  requirements.txt  .gitignore</div>`;
          break;
        case 'clear':
          terminalOutputBuffer = ''; // Clear buffer before adding prompt
          break;
        case 'help':
          output = `<div>Available commands:</div>
<div class="ml-2">python manage.py runserver - Simulates starting Django server.</div>
<div class="ml-2">python manage.py migrate - Simulates running migrations.</div>
<div class="ml-2">ls - Lists (simulated) project files.</div>
<div class="ml-2">clear - Clears the terminal screen.</div>
<div class="ml-2">help - Shows this help message.</div>`;
          break;
        default:
          if (command !== '') {
            output = `<div>command not found: ${escapeHtml(command)}</div>`;
          }
      }
      if (output) appendToTerminalOutput(output);
      
      currentCommand = ''; // Reset current command input
      appendToTerminalOutput(`<div>${terminalPrompt}<span id="current-command-display"></span><span class="terminal-caret"></span></div>`);
    }
    
    initTerminal();
    
    // Terminal keyboard input handler
    // Changed from document to terminalDisplayArea to only capture when terminal is focused
    terminalDisplayArea.addEventListener('keydown', function(e) {
      if (terminalElement.classList.contains('hidden')) return; // Only if terminal is visible
      
      const key = e.key;
      
      // Prevent default browser behavior for keys like ArrowUp, ArrowDown, Tab if needed
      if (['Enter', 'Backspace', 'ArrowUp', 'ArrowDown', 'Tab'].includes(key)) {
          e.preventDefault();
      }

      if (key === 'Enter') {
        processCommand(currentCommand);
      } else if (key === 'Backspace') {
        currentCommand = currentCommand.slice(0, -1);
      } else if (key === 'ArrowUp') {
        if (historyIndex > 0) {
          historyIndex--;
          currentCommand = commandHistory[historyIndex];
        }
      } else if (key === 'ArrowDown') {
        if (historyIndex < commandHistory.length - 1) {
          historyIndex++;
          currentCommand = commandHistory[historyIndex];
        } else {
          historyIndex = commandHistory.length;
          currentCommand = '';
        }
      } else if (!e.ctrlKey && !e.altKey && !e.metaKey && key.length === 1) { // Regular character input
        currentCommand += key;
      }
      // Update display after processing key, only if it's not Enter (which calls processCommand that updates)
      if (key !== 'Enter') {
         updateTerminalDisplay();
      }
    });
    
    toggleTerminalBtn.addEventListener('click', function() {
      terminalElement.classList.toggle('hidden');
      if (!terminalElement.classList.contains('hidden')) {
        terminalDisplayArea.scrollTop = terminalDisplayArea.scrollHeight;
        terminalDisplayArea.focus(); // Focus the terminal area for input
      }
    });
    
    closeTerminalBtn.addEventListener('click', function() {
      terminalElement.classList.add('hidden');
    });
    
    clearTerminalBtn.addEventListener('click', function() {
      terminalOutputBuffer = ''; // Clear buffer
      currentCommand = '';     // Clear current command input
      appendToTerminalOutput(`<div>${terminalPrompt}<span id="current-command-display"></span><span class="terminal-caret"></span></div>`);
      terminalDisplayArea.focus();
    });
    
    // Focus terminal when clicking inside it
    terminalDisplayArea.addEventListener('click', function() {
      this.focus();
    });
    
    // File tree functionality
    const fileTreeItems = document.querySelectorAll('.file-tree-item[data-folder]');
    fileTreeItems.forEach(item => {
      item.addEventListener('click', function(event) {
        // Prevent toggling folder if a file inside it was clicked and event bubbled up.
        // This check is mostly for complex trees; here, file items are distinct.
        if (event.target.closest('.file-tree-item[data-file]')) {
            return;
        }

        const folderName = this.getAttribute('data-folder');
        // ID for children container, e.g. "VPRO-children", "Vapp/templates-children"
        const childrenContainer = document.getElementById(`${folderName}-children`);
        const arrowIcon = this.querySelector('i.bi-chevron-right');
        
        if (childrenContainer) {
          childrenContainer.classList.toggle('open');
          if (arrowIcon) {
            arrowIcon.classList.toggle('chevron-rotate');
          }
        }
      });
    });
    
    document.getElementById('refresh-explorer').addEventListener('click', function() {
      const icon = this.querySelector('i');
      icon.classList.add('animate-spin');
      setTimeout(() => icon.classList.remove('animate-spin'), 1000);
      // Add actual refresh logic here if needed
      console.log("Explorer refresh clicked (simulated).");
    });
    
    // Chat functionality
    const chatInput = document.getElementById('chat-input');
    const sendMessageBtn = document.getElementById('send-message-btn');
    const chatMessagesContainer = document.querySelector('.chat-messages');
    
    function sendChatMessage() {
      const messageText = chatInput.value.trim();
      if (messageText === '') return;
      
      const timeString = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const userMessageHtml = `
      <div class="mb-4">
        <div class="flex items-start justify-end mb-1">
          <div class="bg-primary text-white rounded-lg p-3 max-w-[85%]">
            <p class="text-sm">${escapeHtml(messageText)}</p>
          </div>
          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 ml-2 flex-shrink-0">
            <span class="text-sm font-medium">U</span>
          </div>
        </div>
        <span class="text-xs text-gray-500 dark:text-gray-400 mr-10 flex justify-end">${timeString}</span>
      </div>`;
      chatMessagesContainer.insertAdjacentHTML('beforeend', userMessageHtml);
      chatInput.value = '';
      chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
      
      setTimeout(() => {
        const botResponses = [
          "Je regarde ça pour vous.",
          "Pourriez-vous préciser votre question concernant les modèles Django ?",
          "Avez-vous consulté la documentation officielle de Django à ce sujet ?",
          "Les vues basées sur les classes (CBV) pourraient simplifier votre code.",
          "Pensez à utiliser `select_related` ou `prefetch_related` pour optimiser vos requêtes."
        ];
        const randomResponse = botResponses[Math.floor(Math.random() * botResponses.length)];
        const botTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const botMessageHtml = `
        <div class="mb-4">
          <div class="flex items-start mb-1">
            <div class="flex h-8 w-8 items-center justify-center rounded-full bg-primary text-white mr-2 flex-shrink-0">
              <span class="text-sm font-medium">V</span>
            </div>
            <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-3 max-w-[85%]">
              <p class="text-sm">${escapeHtml(randomResponse)}</p>
            </div>
          </div>
          <span class="text-xs text-gray-500 dark:text-gray-400 ml-10">${botTime}</span>
        </div>`;
        chatMessagesContainer.insertAdjacentHTML('beforeend', botMessageHtml);
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
      }, 1200);
    }
    
    sendMessageBtn.addEventListener('click', sendChatMessage);
    chatInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendChatMessage();
      }
    });
    
    // Resizable panels
    const fileExplorer = document.getElementById('file-explorer');
    const fileExplorerResizer = document.getElementById('file-explorer-resizer');
    let isResizing = false;
    
    fileExplorerResizer.addEventListener('mousedown', function(e) {
      e.preventDefault(); // Prevent text selection during drag
      isResizing = true;
      document.body.style.cursor = 'ew-resize'; // Change cursor for the whole body
      document.body.classList.add('select-none'); // Prevent text selection
      fileExplorerResizer.classList.add('active');
    });
    
    document.addEventListener('mousemove', function(e) {
      if (!isResizing) return;
      const newWidth = e.clientX;
      // Set min/max width constraints
      const minWidth = 150;
      const maxWidth = window.innerWidth / 2; 
      if (newWidth >= minWidth && newWidth <= maxWidth) {
        fileExplorer.style.width = newWidth + 'px';
        if (typeof editor !== 'undefined' && editor) editor.layout(); // Trigger editor layout adjustment
      }
    });
    
    document.addEventListener('mouseup', function() {
      if (isResizing) {
        isResizing = false;
        document.body.style.cursor = ''; // Reset cursor
        document.body.classList.remove('select-none');
        fileExplorerResizer.classList.remove('active');
      }
    });
  });
</script>
</body>
</html>